@model IEnumerable<Chapter>
@{
    ViewData["Title"] = "Unified Content Manager";
}

<div class="admin-card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h4 class="text-white mb-0">
            <i class="fas fa-layer-group me-2 text-primary"></i> Unified Content Manager
        </h4>
        <div class="text-white-50 small">
            Showing latest 100 chapters
        </div>
    </div>

    <div class="card-body">
        
        <div class="mb-4">
            <form asp-action="ManageContent" method="get" class="d-flex gap-2">
                <input type="text" name="search" class="form-control admin-input" placeholder="Search manga, chapter title or number..." value="@ViewBag.Search">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search me-1"></i> Search
                </button>
                @if (!string.IsNullOrEmpty(ViewBag.Search))
                {
                    <a asp-action="ManageContent" class="btn btn-secondary">Clear</a>
                }
            </form>
        </div>

        <div class="table-responsive">
            <table class="table admin-table align-middle">
                <thead>
                    <tr class="text-white small uppercase">
                        <th>
                            <a asp-action="ManageContent" asp-route-sort="@(ViewBag.CurrentSort == "manga_asc" ? "manga_desc" : "manga_asc")" asp-route-search="@ViewBag.Search" class="text-decoration-none text-white">
                                Manga <i class="fas fa-sort@(ViewBag.CurrentSort == "manga_asc" ? "-up" : (ViewBag.CurrentSort == "manga_desc" ? "-down" : "")) ms-1"></i>
                            </a>
                        </th>
                        <th class="text-center">
                            <a asp-action="ManageContent" asp-route-sort="@(ViewBag.CurrentSort == "number_desc" ? "number_asc" : "number_desc")" asp-route-search="@ViewBag.Search" class="text-decoration-none text-white">
                                Chapter <i class="fas fa-sort@(ViewBag.CurrentSort == "number_asc" ? "-up" : (ViewBag.CurrentSort == "number_desc" ? "-down" : "")) ms-1"></i>
                            </a>
                        </th>
                        <th class="text-center">
                            <a asp-action="ManageContent" asp-route-sort="@(ViewBag.CurrentSort == "comments_desc" ? "comments_asc" : "comments_desc")" asp-route-search="@ViewBag.Search" class="text-decoration-none text-white">
                                Comments <i class="fas fa-sort@(ViewBag.CurrentSort == "comments_asc" ? "-up" : (ViewBag.CurrentSort == "comments_desc" ? "-down" : "")) ms-1"></i>
                            </a>
                        </th>
                        <th class="text-center">
                            <a asp-action="ManageContent" asp-route-sort="@(ViewBag.CurrentSort == "views_desc" ? "views_asc" : "views_desc")" asp-route-search="@ViewBag.Search" class="text-decoration-none text-white">
                                Views <i class="fas fa-sort@(ViewBag.CurrentSort == "views_asc" ? "-up" : (ViewBag.CurrentSort == "views_desc" ? "-down" : "")) ms-1"></i>
                            </a>
                        </th>
                        <th class="text-center">
                            <a asp-action="ManageContent" asp-route-sort="@(ViewBag.CurrentSort == "date_desc" ? "date_asc" : "date_desc")" asp-route-search="@ViewBag.Search" class="text-decoration-none text-white">
                                Uploaded <i class="fas fa-sort@(ViewBag.CurrentSort == "date_asc" ? "-up" : (ViewBag.CurrentSort == "date_desc" ? "-down" : "")) ms-1"></i>
                            </a>
                        </th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Any())
                    {
                        @foreach (var chapter in Model)
                        {
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="@chapter.Manga?.ImageUrl" alt="" class="rounded me-2" style="width: 30px; height: 40px; object-fit: cover; border: 1px solid var(--admin-border);">
                                        <div class="text-white fw-medium text-truncate-1" style="max-width: 200px;">
                                            @chapter.Manga?.Title
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-primary fw-bold">Ch. @chapter.ChapterNumber.ToString("G29")</div>
                                    <div class="text-white-50 small text-truncate-1" style="max-width: 150px;">
                                        @(string.IsNullOrEmpty(chapter.Title) ? "No Title" : chapter.Title)
                                    </div>
                                </td>
                                <td class="text-center">
                                    <a asp-action="ManageComments" asp-route-chapterId="@chapter.Id" class="badge bg-dark border border-info text-info rounded-pill px-3 text-decoration-none">
                                        <i class="fas fa-comments me-1"></i>@(chapter.Comments?.Count ?? 0)
                                    </a>
                                </td>
                                <td class="text-center">
                                    <span class="text-white"><i class="fas fa-eye me-1 text-white-50"></i>@chapter.ViewCount.ToString("N0")</span>
                                </td>
                                <td class="text-center text-white-50 small">
                                    @chapter.CreatedAt.ToString("MMM dd, yyyy")<br>
                                    @chapter.CreatedAt.ToString("HH:mm")
                                </td>
                                <td>
                                    <div class="d-flex justify-content-end gap-1">
                                        <a asp-action="EditChapter" asp-route-id="@chapter.Id" class="btn btn-sm btn-outline-primary" title="Edit Chapter">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a asp-action="PageList" asp-route-chapterId="@chapter.Id" class="btn btn-sm btn-outline-info" title="Manage Pages">
                                            <i class="fas fa-images"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="6" class="text-center py-5 text-white-50">
                                <i class="fas fa-layer-group mb-3 d-block fs-2"></i>
                                No content found.
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
